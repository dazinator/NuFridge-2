<!DOCTYPE html>
<html>
    <head>
        <title>NuFridge</title>
        
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <meta name="format-detection" content="telephone=no"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        %semanticuicss%
        %customcss%
        <script type="text/javascript">
            if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
                var msViewportStyle = document.createElement("style");
                var mq = "@@-ms-viewport{width:auto!important}";
                msViewportStyle.appendChild(document.createTextNode(mq));
                document.getElementsByTagName("head")[0].appendChild(msViewportStyle);
            }
        </script>
%jqueryscript%
    </head>
<body>
<main>

    <div id="applicationHost">
        <div class="container">

            <div class="ui segment loadingApplicationSpinner">
                <div class="ui active dimmer">
                    <div class="ui large text loader">%status%</div>
                </div>
                <p></p>
                <p></p>
                <p></p>
            </div>

        </div>
    </div>
</main>

<script>
    var isCheckingStatus = false;

    function checkStatus() {

        if (isCheckingStatus === true) {
            return false;
        }

        isCheckingStatus = true;

        var dfd = jQuery.Deferred();

        $.ajax({
            type: 'GET',
            url: window.location.pathname,
            success: function (data, textStatus, request) {
                var status = request.getResponseHeader('NuFridge-Status');
                if (status === "startup") {
                    $(".loadingApplicationSpinner .text.loader").text(data);
                    isCheckingStatus = false;
                    dfd.resolve();
                } else {
                    $(".loadingApplicationSpinner .text.loader").text('NuFridge has started, the page will be reloaded.');
                    location.reload(true);
                }
            },
            error: function () {
                $(".loadingApplicationSpinner .text.loader").text('There was an error communicating with the server.');
                isCheckingStatus = false;
                dfd.reject();
            }
        });

        return dfd.promise();
    }

    $(document).ready(function () {
        checkStatus().always(function() {
            setInterval(function() {
                checkStatus();
            }, 2000);
        });
    });
</script>
</body>
</html>